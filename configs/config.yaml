# Default configuration for 3D potential field prediction
# Best parameters based on ablation studies - see CLAUDE.md for details
#
# Best model: layers6_analytical (Rel L2 = 0.118)
# - FNO with 6 layers + analytical monopole solution as input
# - Additive spacing conditioning
# - TV regularization

data:
  data_dir: data
  train_split: 0.7
  val_split: 0.15
  test_split: 0.15
  batch_size: 1
  num_workers: 0
  pin_memory: true

model:
  backbone: fno  # Options: "fno", "unet"
  add_analytical_solution: true  # Add monopole analytical solution as input (recommended)
  geometry_encoder:
    enabled: true
    hidden_dim: 64
    num_layers: 2
  fno:
    modes1: 8
    modes2: 8
    modes3: 8
    width: 32
    num_layers: 6  # Best: 6 layers
    fc_dim: 128
  unet:
    base_channels: 32
    depth: 4
    dropout: 0.1

training:
  epochs: 100
  learning_rate: 0.001
  weight_decay: 0.00001
  scheduler: cosine
  scheduler_params:
    T_max: 100
    eta_min: 0.000001
  checkpoint_dir: checkpoints
  checkpoint_freq: 10
  resume_from: null
  early_stopping_patience: 10
  early_stopping_delta: 0.000001

# Loss function configuration
# Available: MSE + gradient consistency + TV + PDE residual + gradient matching
loss:
  pde_weight: 0.0  # PDE residual loss (optional)
  tv_weight: 0.01  # Total variation regularizer (recommended for smoothness)
  gradient_matching_weight: 0.0  # Gradient matching (use 0.1 for better super-res)

# Spacing conditioning (uses additive mode - the best approach)
spacing:
  use_spacing_conditioning: true  # Recommended: true

# Experiment settings
experiment:
  use_singularity_mask: true  # Always exclude singularity region

grid:
  base_resolution: [96, 48, 48]
  train_resolution: [96, 48, 48]
  test_resolution: [96, 48, 48]
  coord_range: [-1.0, 1.0]
  log_conductivity: false
  conductivity_epsilon: 0.000001

physics:
  analytical:
    epsilon_factor: 0.1
    current_I: 1.0
  pde:
    conductivity_threshold: 0.000001
  mse:
    singularity_mask_radius: 3

logging:
  use_wandb: false
  use_tensorboard: true
  log_dir: logs
  project_name: neural-operator-3d
  experiment_name: potential_prediction
  vis_freq: 10
  vis_slices: [axial, sagittal]
  vis_dir: visualizations

evaluation:
  resolution_invariance_test: true
  test_resolutions:
    - [192, 96, 96]
    - [96, 48, 48]
